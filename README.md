# tfn - Terraform Notify

Terraform CLI wrapper that sends **Telegram notifications** on command completion.

```
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚  tfn plan -chdir=terraform/environments/crm_dev             â”‚
 â”‚                                                              â”‚
 â”‚  = terraform plan -chdir=terraform/environments/crm_dev      â”‚
 â”‚  + Telegram notification on completion                       â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Overview

`tfn`ì€ `terraform` ëª…ë ¹ì–´ë¥¼ **ê·¸ëŒ€ë¡œ ê°ì‹¸ëŠ”(wrapping)** Go ë°”ì´ë„ˆë¦¬ì…ë‹ˆë‹¤.
ê¸°ì¡´ terraform ì‚¬ìš©ë²•ì„ ì „í˜€ ë°”ê¾¸ì§€ ì•Šìœ¼ë©´ì„œ, ì£¼ìš” ëª…ë ¹(`plan`, `apply`, `init`, `validate`) ì™„ë£Œ ì‹œ Telegramìœ¼ë¡œ ê²°ê³¼ ì•Œë¦¼ì„ ë³´ëƒ…ë‹ˆë‹¤.

**í•µì‹¬ ì›ì¹™: Zero Interference** - terraformì˜ ëª¨ë“  ë™ì‘(ì¶œë ¥, ì…ë ¥, exit code)ì„ 100% ë³´ì¡´í•©ë‹ˆë‹¤.

---

## Architecture

### Project Structure

```
~/khko_tools/tfn/
â”œâ”€â”€ main.go           # Entrypoint - args íŒŒì‹±, ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
â”œâ”€â”€ runner.go         # Terraform í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰ + I/O ìŠ¤íŠ¸ë¦¬ë°
â”œâ”€â”€ notifier.go       # Telegram Bot API í˜¸ì¶œ + ë©”ì‹œì§€ í¬ë§·íŒ…
â”œâ”€â”€ config.go         # ì„¤ì • ë¡œë“œ (env vars â†’ config file)
â”œâ”€â”€ go.mod            # Go module (stdlib only, ì™¸ë¶€ ì˜ì¡´ì„± ì—†ìŒ)
â””â”€â”€ README.md
```

### Dependencies

```
ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬: ì—†ìŒ (zero dependencies)
ì‚¬ìš©ëœ Go stdlib íŒ¨í‚¤ì§€: 11ê°œ
```

### Package Map (ì „ì²´ íŒ¨í‚¤ì§€ ì‚¬ìš©ì²˜)

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  main.go    â”‚  runner.go   â”‚ notifier.go  â”‚  config.go   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  os         â”‚  os          â”‚  encoding/   â”‚  os          â”‚
  â”‚  fmt        â”‚  os/exec     â”‚    json      â”‚  bufio       â”‚
  â”‚  time       â”‚  io          â”‚  net/http    â”‚  path/       â”‚
  â”‚             â”‚  bytes       â”‚  fmt         â”‚    filepath  â”‚
  â”‚             â”‚  strings     â”‚  strings     â”‚  strings     â”‚
  â”‚             â”‚              â”‚  time        â”‚              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Package Reference (íŒ¨í‚¤ì§€ë³„ ìƒì„¸)

> 11ê°œ Go stdlib íŒ¨í‚¤ì§€ì˜ ì—­í• , ì‚¬ìš©ëœ í•¨ìˆ˜/íƒ€ì…, ì‹¤ì œ í˜¸ì¶œ ìœ„ì¹˜ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤.

### 1. `os` â€” ìš´ì˜ì²´ì œ ì¸í„°í˜ì´ìŠ¤

í”„ë¡œì„¸ìŠ¤ í™˜ê²½(args, exit code, í™˜ê²½ë³€ìˆ˜, íŒŒì¼ì‹œìŠ¤í…œ, stdio)ì— ì ‘ê·¼í•˜ëŠ” ê¸°ë³¸ íŒ¨í‚¤ì§€.

```
  ì—­í• : í”„ë¡œì„¸ìŠ¤ì™€ OS ì‚¬ì´ì˜ ëª¨ë“  ìƒí˜¸ì‘ìš©
  ì‚¬ìš© íŒŒì¼: main.go, runner.go, config.go
```

**ì‚¬ìš©ëœ í•¨ìˆ˜/ë³€ìˆ˜:**

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ í•¨ìˆ˜/ë³€ìˆ˜            â”‚ ìš©ë„                                         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ os.Args             â”‚ CLI ì¸ì ìˆ˜ì‹  (os.Args[1:]ë¡œ tfn ìì‹  ì œì™¸)  â”‚
  â”‚ os.Exit(code)       â”‚ terraformì˜ exit codeë¥¼ ê·¸ëŒ€ë¡œ í”„ë¡œì„¸ìŠ¤ì— ë°˜í™˜â”‚
  â”‚ os.Stdin            â”‚ í„°ë¯¸ë„ stdin â†’ terraform stdin ì§ì ‘ ì—°ê²°      â”‚
  â”‚ os.Stdout           â”‚ terraform stdout â†’ í„°ë¯¸ë„ ì‹¤ì‹œê°„ ì¶œë ¥         â”‚
  â”‚ os.Stderr           â”‚ terraform stderr â†’ í„°ë¯¸ë„ ì‹¤ì‹œê°„ ì¶œë ¥         â”‚
  â”‚ os.Getwd()          â”‚ -chdir ì—†ì„ ë•Œ í˜„ì¬ ë””ë ‰í† ë¦¬ëª… ì¶”ì¶œ           â”‚
  â”‚ os.Getenv(key)      â”‚ TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID ì½ê¸°    â”‚
  â”‚ os.UserHomeDir()    â”‚ ~/.tfn.env ê²½ë¡œ êµ¬ì„±ì„ ìœ„í•œ í™ˆ ë””ë ‰í† ë¦¬ ì¡°íšŒ  â”‚
  â”‚ os.Open(path)       â”‚ ~/.tfn.env íŒŒì¼ ì—´ê¸° (ì½ê¸° ì „ìš©)              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
  ì‹¤ì œ ì½”ë“œ ìœ„ì¹˜:

  main.go:18    args := os.Args[1:]
  main.go:23    os.Exit(result.ExitCode)
  main.go:54    fmt.Fprintf(os.Stderr, "[tfn] notification failed: %v\n", err)
  main.go:59    os.Exit(result.ExitCode)
  main.go:78    dir, err := os.Getwd()

  runner.go:24  cmd.Stdin = os.Stdin
  runner.go:27  cmd.Stdout = os.Stdout
  runner.go:31  cmd.Stderr = io.MultiWriter(os.Stderr, &stderrBuf)

  config.go:25  BotToken: os.Getenv("TELEGRAM_BOT_TOKEN"),
  config.go:26  ChatID:   os.Getenv("TELEGRAM_CHAT_ID"),
  config.go:48  home, err := os.UserHomeDir()
  config.go:54  f, err := os.Open(path)
```

---

### 2. `os/exec` â€” ì™¸ë¶€ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰

`terraform` ë°”ì´ë„ˆë¦¬ë¥¼ ìì‹ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰í•˜ê³  I/O íŒŒì´í”„ì™€ exit codeë¥¼ ê´€ë¦¬í•˜ëŠ” í•µì‹¬ íŒ¨í‚¤ì§€.

```
  ì—­í• : tfnì˜ ì¡´ì¬ ì´ìœ  â€” terraform í”„ë¡œì„¸ìŠ¤ë¥¼ spawní•˜ê³  ì œì–´
  ì‚¬ìš© íŒŒì¼: runner.go
```

**ì‚¬ìš©ëœ í•¨ìˆ˜/íƒ€ì…:**

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ í•¨ìˆ˜/íƒ€ì…                 â”‚ ìš©ë„                                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ exec.Command(name, args) â”‚ terraform ëª…ë ¹ êµ¬ì„± (ì•„ì§ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ) â”‚
  â”‚ cmd.Stdin                â”‚ ìì‹ í”„ë¡œì„¸ìŠ¤ì˜ stdin ì—°ê²° ì„¤ì •          â”‚
  â”‚ cmd.Stdout               â”‚ ìì‹ í”„ë¡œì„¸ìŠ¤ì˜ stdout ì¶œë ¥ ëŒ€ìƒ ì„¤ì •    â”‚
  â”‚ cmd.Stderr               â”‚ ìì‹ í”„ë¡œì„¸ìŠ¤ì˜ stderr ì¶œë ¥ ëŒ€ìƒ ì„¤ì •    â”‚
  â”‚ cmd.Run()                â”‚ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰ + ì¢…ë£Œê¹Œì§€ ëŒ€ê¸° (blocking) â”‚
  â”‚ *exec.ExitError          â”‚ ë¹„ì •ìƒ ì¢…ë£Œ ì‹œ ì—ëŸ¬ íƒ€ì… (exit code í¬í•¨)â”‚
  â”‚ ExitError.ExitCode()     â”‚ ìì‹ í”„ë¡œì„¸ìŠ¤ì˜ exit code ì¶”ì¶œ           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
  ë™ì‘ íë¦„:

  exec.Command("terraform", args...)     í”„ë¡œì„¸ìŠ¤ ê°ì²´ ìƒì„±
       â”‚
       â–¼
  cmd.Stdin  = os.Stdin                  I/O íŒŒì´í”„ ì—°ê²°
  cmd.Stdout = os.Stdout
  cmd.Stderr = io.MultiWriter(...)
       â”‚
       â–¼
  cmd.Run()                              ì‹¤í–‰ + ë¸”ë¡œí‚¹ ëŒ€ê¸°
       â”‚
       â–¼
  err.(*exec.ExitError)                  exit code ì¶”ì¶œ
       â”‚
       â”œâ”€ err == nil         â†’ exit code 0 (ì„±ê³µ)
       â”œâ”€ ExitError          â†’ exit code N (terraform ì—ëŸ¬)
       â””â”€ ê·¸ ì™¸ error        â†’ exit code 1 (binary not found ë“±)
```

```
  ì‹¤ì œ ì½”ë“œ:

  runner.go:21  cmd := exec.Command("terraform", args...)
  runner.go:33  err := cmd.Run()
  runner.go:37  if exitErr, ok := err.(*exec.ExitError); ok {
  runner.go:38      exitCode = exitErr.ExitCode()
```

---

### 3. `io` â€” ê¸°ë³¸ I/O ì¸í„°í˜ì´ìŠ¤

Goì˜ ëª¨ë“  I/O ì¶”ìƒí™”ì˜ ê¸°ë°˜. tfnì—ì„œëŠ” ì¶œë ¥ ìŠ¤íŠ¸ë¦¼ì„ ë¶„ê¸°(tee)í•˜ëŠ” `MultiWriter`ë¥¼ ì‚¬ìš©.

```
  ì—­í• : stderrë¥¼ "í„°ë¯¸ë„ ì¶œë ¥"ê³¼ "ë²„í¼ ìº¡ì²˜" ë‘ ê³³ì— ë™ì‹œì— ì“°ê¸°
  ì‚¬ìš© íŒŒì¼: runner.go
```

**ì‚¬ìš©ëœ í•¨ìˆ˜:**

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ í•¨ìˆ˜                         â”‚ ìš©ë„                                â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ io.MultiWriter(writers...)  â”‚ ì—¬ëŸ¬ Writerì— ë™ì‹œì— ì“°ëŠ” Writer ìƒì„±â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
  MultiWriter ë™ì‘ ì›ë¦¬:

  terraform stderr ì¶œë ¥
       â”‚
       â–¼
  io.MultiWriter(os.Stderr, &stderrBuf)
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> os.Stderr     â†’ í„°ë¯¸ë„ì— ì‹¤ì‹œê°„ í‘œì‹œ (ì‚¬ìš©ìê°€ ë´„)
       â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> stderrBuf     â†’ bytes.Bufferì— ìº¡ì²˜ (ì•Œë¦¼ìš©)
                                    â†’ lastNLines()ë¡œ ë§ˆì§€ë§‰ 10ì¤„ ì¶”ì¶œ
```

```
  Unixì˜ tee ëª…ë ¹ê³¼ ë™ì¼í•œ ê°œë…:

  $ terraform plan 2>&1 | tee /tmp/stderr.log
                           ~~~
                    ì´ê²ƒì´ io.MultiWriter
```

```
  ì‹¤ì œ ì½”ë“œ:

  runner.go:31  cmd.Stderr = io.MultiWriter(os.Stderr, &stderrBuf)
```

---

### 4. `bytes` â€” ë°”ì´íŠ¸ ë²„í¼

ê°€ë³€ ê¸¸ì´ ë°”ì´íŠ¸ ë²„í¼. `io.Writer` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë¯€ë¡œ `MultiWriter`ì˜ ëŒ€ìƒìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥.

```
  ì—­í• : terraform stderr ì¶œë ¥ì„ ë©”ëª¨ë¦¬ì— ëˆ„ì  ìº¡ì²˜
  ì‚¬ìš© íŒŒì¼: runner.go
```

**ì‚¬ìš©ëœ íƒ€ì…:**

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ íƒ€ì…/ë©”ì„œë“œ           â”‚ ìš©ë„                                        â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ bytes.Buffer        â”‚ stderr ì¶œë ¥ì„ ë©”ëª¨ë¦¬ì— ì¶•ì í•˜ëŠ” ë²„í¼          â”‚
  â”‚ Buffer.String()     â”‚ ì¶•ì ëœ ë°”ì´íŠ¸ë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
  bytes.Bufferê°€ io.Writerë¥¼ ë§Œì¡±í•˜ëŠ” ì´ìœ :

  type Writer interface {
      Write(p []byte) (n int, err error)
  }

  bytes.BufferëŠ” Write() ë©”ì„œë“œë¥¼ êµ¬í˜„
  â†’ io.MultiWriterì˜ ì¸ìë¡œ ì „ë‹¬ ê°€ëŠ¥
  â†’ terraformì´ stderrì— ì“¸ ë•Œë§ˆë‹¤ Bufferì—ë„ ìë™ ì¶•ì 
```

```
  ì‹¤ì œ ì½”ë“œ:

  runner.go:30  var stderrBuf bytes.Buffer
  runner.go:31  cmd.Stderr = io.MultiWriter(os.Stderr, &stderrBuf)
  runner.go:47  Stderr: lastNLines(stderrBuf.String(), 10),
```

---

### 5. `strings` â€” ë¬¸ìì—´ ì¡°ì‘

ë¬¸ìì—´ ê²€ìƒ‰, ë¶„í• , ì¹˜í™˜, ì¡°í•© ë“± ë²”ìš© ë¬¸ìì—´ ì²˜ë¦¬ íŒ¨í‚¤ì§€.

```
  ì—­í• : ë©”ì‹œì§€ í¬ë§·íŒ…, íŠ¹ìˆ˜ë¬¸ì ì´ìŠ¤ì¼€ì´í”„, í…ìŠ¤íŠ¸ íŒŒì‹±
  ì‚¬ìš© íŒŒì¼: runner.go, notifier.go, config.go
```

**ì‚¬ìš©ëœ í•¨ìˆ˜/íƒ€ì…:**

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ í•¨ìˆ˜/íƒ€ì…                 â”‚ ìš©ë„                                      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ strings.Split(s, sep)    â”‚ stderrë¥¼ ì¤„ ë‹¨ìœ„ë¡œ ë¶„ë¦¬ ("\n" ê¸°ì¤€)        â”‚
  â”‚ strings.Join(s, sep)     â”‚ ë¶„ë¦¬ëœ ì¤„ì„ ë‹¤ì‹œ í•˜ë‚˜ì˜ ë¬¸ìì—´ë¡œ í•©ì¹¨      â”‚
  â”‚ strings.TrimSpace(s)     â”‚ stderr ì•ë’¤ ê³µë°±/ê°œí–‰ ì œê±°                 â”‚
  â”‚ strings.ReplaceAll(s,..) â”‚ MarkdownV2 íŠ¹ìˆ˜ë¬¸ì 19ì¢… ì´ìŠ¤ì¼€ì´í”„         â”‚
  â”‚ strings.NewReader(s)     â”‚ JSON ë¬¸ìì—´ì„ io.Readerë¡œ ë³€í™˜ (HTTP body) â”‚
  â”‚ strings.Cut(s, sep)      â”‚ "KEY=VALUE"ë¥¼ KEYì™€ VALUEë¡œ ë¶„ë¦¬           â”‚
  â”‚ strings.Trim(s, cutset)  â”‚ config ê°’ì—ì„œ ë”°ì˜´í‘œ("') ì œê±°              â”‚
  â”‚ strings.Builder          â”‚ Telegram ë©”ì‹œì§€ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì¡°ë¦½           â”‚
  â”‚ Builder.WriteString(s)   â”‚ Builderì— ë¬¸ìì—´ ì¶”ê°€                      â”‚
  â”‚ Builder.String()         â”‚ ì¡°ë¦½ëœ ìµœì¢… ë¬¸ìì—´ ë°˜í™˜                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
  strings.Builder vs ë¬¸ìì—´ ì—°ê²°(+):

  // Bad - ë§¤ë²ˆ ìƒˆ ë¬¸ìì—´ í• ë‹¹ (O(nÂ²))
  result := ""
  result += "line1\n"
  result += "line2\n"
  result += "line3\n"

  // Good - ë‚´ë¶€ ë²„í¼ì— ì¶”ê°€ (O(n))
  var b strings.Builder
  b.WriteString("line1\n")
  b.WriteString("line2\n")
  b.WriteString("line3\n")
  return b.String()
```

```
  strings.Cut (Go 1.18+) â€” config íŒŒì‹±ì˜ í•µì‹¬:

  ì…ë ¥: "TELEGRAM_BOT_TOKEN=123:ABC"
  strings.Cut(line, "=")
  â†’ key="TELEGRAM_BOT_TOKEN", value="123:ABC", ok=true

  ì…ë ¥: "# ì£¼ì„ ë¼ì¸"
  strings.Cut(line, "=")
  â†’ key="# ì£¼ì„ ë¼ì¸", value="", ok=false â†’ ìŠ¤í‚µ
```

```
  ì‹¤ì œ ì½”ë“œ:

  runner.go:53   strings.Split(strings.TrimSpace(s), "\n")
  runner.go:57   strings.Join(lines, "\n")

  notifier.go:45 strings.NewReader(string(body))
  notifier.go:60 var b strings.Builder
  notifier.go:106 strings.ReplaceAll(result, ch, "\\"+ch)

  config.go:70   key, value, ok := strings.Cut(line, "=")
  config.go:75   key = strings.TrimSpace(key)
  config.go:78   value = strings.Trim(value, "\"'")
```

---

### 6. `fmt` â€” í¬ë§·íŒ… I/O

Cì˜ printf ê³„ì—´ê³¼ ìœ ì‚¬í•œ ë¬¸ìì—´ í¬ë§·íŒ…. ì—ëŸ¬ ìƒì„±ê³¼ í¬ë§·íŒ…ëœ ì¶œë ¥ì— ì‚¬ìš©.

```
  ì—­í• : ì—ëŸ¬ ë©”ì‹œì§€ ìƒì„±, í¬ë§·íŒ…ëœ ë¬¸ìì—´ ì¡°í•©
  ì‚¬ìš© íŒŒì¼: main.go, notifier.go
```

**ì‚¬ìš©ëœ í•¨ìˆ˜:**

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ í•¨ìˆ˜                      â”‚ ìš©ë„                                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ fmt.Fprintf(w, f, args)  â”‚ io.Writerì— í¬ë§·íŒ…ëœ ë¬¸ìì—´ ì“°ê¸°        â”‚
  â”‚ fmt.Sprintf(f, args)     â”‚ í¬ë§·íŒ…ëœ ë¬¸ìì—´ ë°˜í™˜ (ì†Œìš”ì‹œê°„, URL ë“±)  â”‚
  â”‚ fmt.Errorf(f, args)      â”‚ í¬ë§·íŒ…ëœ error ìƒì„± (%wë¡œ ì—ëŸ¬ ì²´ì´ë‹)   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
  fmt.Errorfì˜ %w (Go 1.13+) â€” ì—ëŸ¬ ì²´ì´ë‹:

  fmt.Errorf("marshal message: %w", err)
                                ~~
  %wëŠ” ì›ë³¸ ì—ëŸ¬ë¥¼ ê°ì‹¸ì„œ errors.Is(), errors.As()ë¡œ ì¶”ì  ê°€ëŠ¥
  â†’ ë””ë²„ê¹… ì‹œ "marshal message: json: unsupported type" ê°™ì€ ì²´ì¸ ì¶œë ¥
```

```
  ì‹¤ì œ ì½”ë“œ:

  main.go:54      fmt.Fprintf(os.Stderr, "[tfn] notification failed: %v\n", err)
  notifier.go:40  fmt.Errorf("marshal message: %w", err)
  notifier.go:43  fmt.Sprintf("https://api.telegram.org/bot%s/sendMessage", cfg.BotToken)
  notifier.go:47  fmt.Errorf("send request: %w", err)
  notifier.go:51  fmt.Errorf("telegram API returned status %d", resp.StatusCode)
  notifier.go:77  fmt.Sprintf("â± ì†Œìš”ì‹œê°„: %.1fs", p.Duration.Seconds())
```

---

### 7. `time` â€” ì‹œê°„ ì¸¡ì •

ì‹œê°„ ê¸°ë¡, ê²½ê³¼ ì‹œê°„ ê³„ì‚°, Duration íƒ€ì… ì œê³µ.

```
  ì—­í• : terraform ì‹¤í–‰ ì†Œìš”ì‹œê°„ ì¸¡ì • â†’ ì•Œë¦¼ ë©”ì‹œì§€ì— í¬í•¨
  ì‚¬ìš© íŒŒì¼: main.go, notifier.go
```

**ì‚¬ìš©ëœ í•¨ìˆ˜/íƒ€ì…:**

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ í•¨ìˆ˜/íƒ€ì…                 â”‚ ìš©ë„                                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ time.Now()               â”‚ terraform ì‹¤í–‰ ì§ì „ ì‹œê° ê¸°ë¡            â”‚
  â”‚ time.Since(t)            â”‚ ê¸°ë¡ ì‹œì ë¶€í„° í˜„ì¬ê¹Œì§€ ê²½ê³¼ ì‹œê°„ ê³„ì‚°     â”‚
  â”‚ time.Duration            â”‚ ê²½ê³¼ ì‹œê°„ì„ ë‹´ëŠ” íƒ€ì… (notifyPayload í•„ë“œ)â”‚
  â”‚ Duration.Seconds()       â”‚ Durationì„ float64 ì´ˆ ë‹¨ìœ„ë¡œ ë³€í™˜        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
  ì¸¡ì • íŒ¨í„´:

  main.go:36  start := time.Now()           // ì‹œì‘ ì‹œê° ê¸°ë¡
  main.go:37  result := runTerraform(args)   // terraform ì‹¤í–‰ (ìˆ˜ ì´ˆ~ìˆ˜ ë¶„)
  main.go:38  elapsed := time.Since(start)   // ê²½ê³¼ ì‹œê°„ ê³„ì‚°

  notifier.go:77  p.Duration.Seconds()       // 12.345678 â†’ "12.3s"
```

---

### 8. `encoding/json` â€” JSON ì§ë ¬í™”

Go êµ¬ì¡°ì²´ë¥¼ JSON ë°”ì´íŠ¸ë¡œ ë³€í™˜. Telegram Bot APIì˜ request body ìƒì„±ì— ì‚¬ìš©.

```
  ì—­í• : telegramMessage êµ¬ì¡°ì²´ â†’ JSON ë¬¸ìì—´ ë³€í™˜
  ì‚¬ìš© íŒŒì¼: notifier.go
```

**ì‚¬ìš©ëœ í•¨ìˆ˜/ê¸°ëŠ¥:**

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ í•¨ìˆ˜/ê¸°ëŠ¥                 â”‚ ìš©ë„                                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ json.Marshal(v)          â”‚ Go struct â†’ JSON []byte ë³€í™˜             â”‚
  â”‚ struct tag `json:"..."`  â”‚ JSON í•„ë“œëª… ë§¤í•‘ (Go: ChatID â†’ chat_id) â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
  ë³€í™˜ ê³¼ì •:

  Go struct                              JSON output
  â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  telegramMessage{                       {
    ChatID:    "-100xxx",       json       "chat_id": "-100xxx",
    Text:      "âœ… ...",       â”€â”€â”€â”€>      "text": "âœ… ...",
    ParseMode: "MarkdownV2",              "parse_mode": "MarkdownV2"
  }                                      }

  struct tagê°€ í•„ë“œëª…ì„ ë³€í™˜:
    ChatID    `json:"chat_id"`     Goì˜ PascalCase â†’ APIì˜ snake_case
    ParseMode `json:"parse_mode"`
```

```
  ì‹¤ì œ ì½”ë“œ:

  notifier.go:23  ChatID    string `json:"chat_id"`
  notifier.go:24  Text      string `json:"text"`
  notifier.go:25  ParseMode string `json:"parse_mode"`
  notifier.go:38  body, err := json.Marshal(msg)
```

---

### 9. `net/http` â€” HTTP í´ë¼ì´ì–¸íŠ¸

HTTP/HTTPS í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ êµ¬í˜„ íŒ¨í‚¤ì§€. TLSê°€ ë‚´ì¥ë˜ì–´ ìˆì–´ HTTPS í˜¸ì¶œì— ë³„ë„ ì„¤ì • ë¶ˆí•„ìš”.

```
  ì—­í• : Telegram Bot APIì— HTTPS POST ìš”ì²­ ì „ì†¡
  ì‚¬ìš© íŒŒì¼: notifier.go
```

**ì‚¬ìš©ëœ í•¨ìˆ˜/ìƒìˆ˜:**

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ í•¨ìˆ˜/ìƒìˆ˜                      â”‚ ìš©ë„                                  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ http.Post(url, contentType,   â”‚ HTTPS POST ìš”ì²­ ì „ì†¡                  â”‚
  â”‚           body io.Reader)     â”‚ (TLS í•¸ë“œì…°ì´í¬ ìë™ ì²˜ë¦¬)             â”‚
  â”‚ http.StatusOK                 â”‚ HTTP 200 ìƒìˆ˜ (ì‘ë‹µ ì„±ê³µ ì—¬ë¶€ íŒë³„)    â”‚
  â”‚ resp.StatusCode               â”‚ ì‘ë‹µ HTTP ìƒíƒœ ì½”ë“œ                   â”‚
  â”‚ resp.Body.Close()             â”‚ ì‘ë‹µ ë°”ë”” ë¦¬ì†ŒìŠ¤ í•´ì œ (defer í•„ìˆ˜)     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
  http.Post ë‚´ë¶€ ë™ì‘:

  http.Post(url, "application/json", body)
       â”‚
       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 1. URL íŒŒì‹±                          â”‚
  â”‚    scheme: https                     â”‚
  â”‚    host: api.telegram.org            â”‚
  â”‚    path: /bot<TOKEN>/sendMessage     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 2. DNS ì¡°íšŒ                          â”‚
  â”‚    api.telegram.org â†’ IP             â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 3. TCP ì—°ê²°                          â”‚
  â”‚    3-way handshake                   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 4. TLS í•¸ë“œì…°ì´í¬ (ìë™)             â”‚
  â”‚    ì¸ì¦ì„œ ê²€ì¦, ì•”í˜¸í™” ì±„ë„ ìˆ˜ë¦½      â”‚
  â”‚    â€» ë³„ë„ ì„¤ì • ë¶ˆí•„ìš” â€” stdlib ë‚´ì¥   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 5. HTTP POST ì „ì†¡                    â”‚
  â”‚    Content-Type: application/json    â”‚
  â”‚    Body: {"chat_id":..., "text":...} â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 6. ì‘ë‹µ ìˆ˜ì‹                          â”‚
  â”‚    StatusCode: 200                   â”‚
  â”‚    Body: {"ok":true,"result":{...}}  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
  defer resp.Body.Close()ê°€ í•„ìš”í•œ ì´ìœ :

  HTTP ì‘ë‹µì˜ BodyëŠ” ë„¤íŠ¸ì›Œí¬ ì†Œì¼“ì— ì—°ê²°ëœ ìŠ¤íŠ¸ë¦¼.
  Close()í•˜ì§€ ì•Šìœ¼ë©´:
    â†’ TCP ì—°ê²°ì´ ì—´ë¦° ì±„ ë‚¨ìŒ
    â†’ ì‹œìŠ¤í…œ file descriptor ëˆ„ìˆ˜
    â†’ ì¥ì‹œê°„ ì‹¤í–‰ ì‹œ "too many open files" ì—ëŸ¬ ê°€ëŠ¥

  deferëŠ” í•¨ìˆ˜ ì¢…ë£Œ ì‹œ ìë™ í˜¸ì¶œì„ ë³´ì¥.
```

```
  ì‹¤ì œ ì½”ë“œ:

  notifier.go:45  resp, err := http.Post(url, "application/json", strings.NewReader(string(body)))
  notifier.go:49  defer resp.Body.Close()
  notifier.go:51  if resp.StatusCode != http.StatusOK {
```

---

### 10. `bufio` â€” ë²„í¼ë§ëœ I/O

íŒŒì¼ì„ ì¤„ ë‹¨ìœ„ë¡œ íš¨ìœ¨ì ìœ¼ë¡œ ì½ëŠ” Scanner ì œê³µ. `~/.tfn.env` íŒŒì‹±ì— ì‚¬ìš©.

```
  ì—­í• : config íŒŒì¼ì„ í•œ ì¤„ì”© ì½ì–´ì„œ KEY=VALUE íŒŒì‹±
  ì‚¬ìš© íŒŒì¼: config.go
```

**ì‚¬ìš©ëœ íƒ€ì…:**

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ íƒ€ì…/ë©”ì„œë“œ               â”‚ ìš©ë„                                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ bufio.NewScanner(r)      â”‚ io.Readerë¥¼ ì¤„ ë‹¨ìœ„ Scannerë¡œ ë˜í•‘       â”‚
  â”‚ scanner.Scan()           â”‚ ë‹¤ìŒ ì¤„ ì½ê¸° (EOFë©´ false ë°˜í™˜)          â”‚
  â”‚ scanner.Text()           â”‚ í˜„ì¬ ì¤„ì˜ ë¬¸ìì—´ ë°˜í™˜ (ê°œí–‰ ì œì™¸)        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
  ~/.tfn.env íŒŒì‹± íë¦„:

  íŒŒì¼ ë‚´ìš©:                      Scanner ë™ì‘:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ # Telegram credentials   â”‚ â†’ Scan() â†’ Text() â†’ '#'ìœ¼ë¡œ ì‹œì‘ â†’ ìŠ¤í‚µ
  â”‚ TELEGRAM_BOT_TOKEN=abc   â”‚ â†’ Scan() â†’ Text() â†’ Cut("=") â†’ key/value
  â”‚ TELEGRAM_CHAT_ID=-100    â”‚ â†’ Scan() â†’ Text() â†’ Cut("=") â†’ key/value
  â”‚                          â”‚ â†’ Scan() â†’ ë¹ˆ ì¤„ â†’ ìŠ¤í‚µ
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â†’ Scan() â†’ false (EOF) â†’ ë£¨í”„ ì¢…ë£Œ
```

```
  bufio.Scanner vs ì§ì ‘ Read:

  // Bad - íŒŒì¼ ì „ì²´ë¥¼ ë©”ëª¨ë¦¬ì— ë¡œë“œ
  data, _ := os.ReadFile(path)
  lines := strings.Split(string(data), "\n")

  // Good - ì¤„ ë‹¨ìœ„ë¡œ ìŠ¤íŠ¸ë¦¬ë° (ë©”ëª¨ë¦¬ íš¨ìœ¨ì )
  scanner := bufio.NewScanner(f)
  for scanner.Scan() {
      line := scanner.Text()
  }
  // â†’ íŒŒì¼ í¬ê¸°ì™€ ë¬´ê´€í•˜ê²Œ í•œ ì¤„ ë¶„ëŸ‰ì˜ ë©”ëª¨ë¦¬ë§Œ ì‚¬ìš©
```

```
  ì‹¤ì œ ì½”ë“œ:

  config.go:61  scanner := bufio.NewScanner(f)
  config.go:62  for scanner.Scan() {
  config.go:63      line := strings.TrimSpace(scanner.Text())
```

---

### 11. `path/filepath` â€” íŒŒì¼ ê²½ë¡œ ì¡°í•©

OSë³„ ê²½ë¡œ êµ¬ë¶„ì(/ vs \)ë¥¼ ìë™ ì²˜ë¦¬í•˜ëŠ” ê²½ë¡œ ì¡°í•© íŒ¨í‚¤ì§€.

```
  ì—­í• : í™ˆ ë””ë ‰í† ë¦¬ + ".tfn.env" ê²½ë¡œë¥¼ OSì— ë§ê²Œ ì¡°í•©
  ì‚¬ìš© íŒŒì¼: config.go
```

**ì‚¬ìš©ëœ í•¨ìˆ˜:**

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ í•¨ìˆ˜                      â”‚ ìš©ë„                                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ filepath.Join(parts...)  â”‚ OS ê²½ë¡œ êµ¬ë¶„ìë¡œ ê²½ë¡œ ì¡°í•©               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
  filepath.Join vs ë¬¸ìì—´ ì—°ê²°:

  // Bad - OS ì˜ì¡´ì 
  path := home + "/.tfn.env"           // Linux/macOSì—ì„œë§Œ ë™ì‘
  path := home + "\\.tfn.env"          // Windowsì—ì„œë§Œ ë™ì‘

  // Good - OS ìë™ ê°ì§€
  path := filepath.Join(home, ".tfn.env")
  // macOS/Linux â†’ /Users/khko/.tfn.env
  // Windows    â†’ C:\Users\khko\.tfn.env
```

```
  ì‹¤ì œ ì½”ë“œ:

  config.go:53  path := filepath.Join(home, ".tfn.env")
```

---

## How It Works

### Execution Flow

```
  User Terminal                    tfn                         Terraform
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€                         â”€â”€â”€â”€â”€â”€â”€â”€â”€
       â”‚                            â”‚                              â”‚
       â”‚  tfn plan -chdir=dev       â”‚                              â”‚
       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                              â”‚
       â”‚                            â”‚                              â”‚
       â”‚                            â”‚  1. Parse args               â”‚
       â”‚                            â”‚  2. Detect subcommand: plan  â”‚
       â”‚                            â”‚  3. Start timer              â”‚
       â”‚                            â”‚                              â”‚
       â”‚                            â”‚  terraform plan -chdir=dev   â”‚
       â”‚                            â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                            â”‚                              â”‚
       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚  â”‚  stdout/stderr streamed â”‚ in real-time (passthrough)   â”‚
       â”‚  â”‚  stdin connected for    â”‚ interactive prompts          â”‚
       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                            â”‚                              â”‚
       â”‚                            â”‚          exit code + stderr  â”‚
       â”‚                            â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                            â”‚                              â”‚
       â”‚                            â”‚  4. Stop timer               â”‚
       â”‚                            â”‚  5. Load config              â”‚
       â”‚                            â”‚  6. Send Telegram notify â”€â”€â”€â”€â”€â”€> Telegram API
       â”‚                            â”‚                              â”‚
       â”‚          exit code         â”‚                              â”‚
       â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
       â”‚                            â”‚                              â”‚
```

### Wrapper Pattern: Transparent Proxy

`tfn`ì€ **Transparent Proxy** íŒ¨í„´ìœ¼ë¡œ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                      Transparent Proxy                          â”‚
  â”‚                                                                 â”‚
  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
  â”‚   â”‚           â”‚â”€â”€â”€â”€ stdin (os.Stdin) â”€â”€â”€â”€â”€â”€â”€â”€>â”‚           â”‚     â”‚
  â”‚   â”‚           â”‚                               â”‚           â”‚     â”‚
  â”‚   â”‚  Terminal â”‚<â”€â”€â”€ stdout (os.Stdout) â”€â”€â”€â”€â”€â”€â”‚ terraform â”‚     â”‚
  â”‚   â”‚           â”‚                               â”‚           â”‚     â”‚
  â”‚   â”‚           â”‚<â”€â”€â”€ stderr â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚     â”‚
  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
  â”‚                              â”‚                                  â”‚
  â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
  â”‚                     â”‚  io.MultiWriter â”‚                         â”‚
  â”‚                     â”‚                 â”‚                         â”‚
  â”‚                     â”‚  os.Stderr â”€â”€â”€â”€â”€â”¼â”€â”€> í„°ë¯¸ë„ ì‹¤ì‹œê°„ ì¶œë ¥   â”‚
  â”‚                     â”‚  stderrBuf â”€â”€â”€â”€â”€â”¼â”€â”€> ì—ëŸ¬ ìº¡ì²˜ (last 10) â”‚
  â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
  â”‚                                                                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•µì‹¬ êµ¬í˜„ (`runner.go`)**:

| I/O       | ì²˜ë¦¬ ë°©ì‹                              | ëª©ì                           |
|-----------|---------------------------------------|-------------------------------|
| `stdin`   | `cmd.Stdin = os.Stdin`                | `apply` ì‹œ yes/no í”„ë¡¬í”„íŠ¸ ì§€ì› |
| `stdout`  | `cmd.Stdout = os.Stdout`              | ì‹¤ì‹œê°„ í„°ë¯¸ë„ ì¶œë ¥ (ë³€ì¡° ì—†ìŒ)   |
| `stderr`  | `io.MultiWriter(os.Stderr, &buf)`     | ì‹¤ì‹œê°„ ì¶œë ¥ + ì—ëŸ¬ ë‚´ìš© ìº¡ì²˜     |
| exit code | `exec.ExitError.ExitCode()`           | terraform exit code ê·¸ëŒ€ë¡œ ë°˜í™˜ |

### Notification Decision

```
  tfn <args...>
       â”‚
       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Parse first non-flag â”‚
  â”‚ arg as subcommand    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     No      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ subcommand in        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚ Passthrough only  â”‚
  â”‚ {plan,apply,         â”‚             â”‚ (no notification) â”‚
  â”‚  init,validate} ?    â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ Yes
             â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Run terraform        â”‚
  â”‚ (stream I/O + timer) â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     No      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Config valid?        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚ Skip notification â”‚
  â”‚ (token + chat_id)    â”‚             â”‚ (graceful degrade)â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ Yes
             â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Send Telegram        â”‚
  â”‚ notification         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Telegram Notification: How It Works

ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ì´ Go í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ `net/http`ë§Œìœ¼ë¡œ Telegram Bot APIë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.

**ì™œ ì™¸ë¶€ SDK ì—†ì´ ê°€ëŠ¥í•œê°€?**

Telegram Bot APIëŠ” ë‹¨ìˆœí•œ REST APIì…ë‹ˆë‹¤. ë©”ì‹œì§€ ì „ì†¡ì€ HTTPS POST í•œ ë²ˆì´ë©´ ëì…ë‹ˆë‹¤.

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                  net/http ê¸°ë°˜ Telegram ì „ì†¡                     â”‚
  â”‚                                                                 â”‚
  â”‚   notifier.go                        Telegram Bot API           â”‚
  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
  â”‚                                                                 â”‚
  â”‚   1. ë©”ì‹œì§€ êµ¬ì„± (Go struct)                                     â”‚
  â”‚      telegramMessage{                                           â”‚
  â”‚        ChatID:    "-100xxx"                                     â”‚
  â”‚        Text:      "âœ… Terraform plan ì„±ê³µ..."                   â”‚
  â”‚        ParseMode: "MarkdownV2"                                  â”‚
  â”‚      }                                                          â”‚
  â”‚          â”‚                                                      â”‚
  â”‚          â–¼                                                      â”‚
  â”‚   2. JSON ì§ë ¬í™” (encoding/json)                                â”‚
  â”‚      json.Marshal(msg)                                          â”‚
  â”‚      â†’ {"chat_id":"-100xxx","text":"...","parse_mode":"..."}    â”‚
  â”‚          â”‚                                                      â”‚
  â”‚          â–¼                                                      â”‚
  â”‚   3. HTTPS POST (net/http)                                      â”‚
  â”‚      http.Post(                                                 â”‚
  â”‚        "https://api.telegram.org/bot<TOKEN>/sendMessage",       â”‚
  â”‚        "application/json",                                      â”‚
  â”‚        body,                                                    â”‚
  â”‚      )                                                          â”‚
  â”‚          â”‚                                                      â”‚
  â”‚          â–¼                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚   4. ì‘ë‹µ í™•ì¸ â”€â”€â”€â”€â”€â”€â”€ HTTP 200 OK? â”€â”€â”€â”€â”€â”€â”€â”€> â”‚ Telegram ì„œë²„ â”‚ â”‚
  â”‚      resp.StatusCode                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚                                                                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì‚¬ìš©ëœ Go stdlib íŒ¨í‚¤ì§€ ì—­í•  ë¶„ë‹´:**

```
  encoding/json â”€â”€â”€ Go struct â†’ JSON ë³€í™˜
                    telegramMessage{...}  â†’  {"chat_id":"...","text":"..."}

  net/http      â”€â”€â”€ HTTP í´ë¼ì´ì–¸íŠ¸ (TLS/HTTPS ë‚´ì¥)
                    http.Post()ë¡œ ë‹¨ì¼ í˜¸ì¶œ, ë³„ë„ í´ë¼ì´ì–¸íŠ¸ ì„¤ì • ë¶ˆí•„ìš”

  strings       â”€â”€â”€ MarkdownV2 íŠ¹ìˆ˜ë¬¸ì ì´ìŠ¤ì¼€ì´í”„ + ë©”ì‹œì§€ ì¡°í•©
                    strings.Builderë¡œ ë©”ì‹œì§€ í¬ë§·íŒ…
                    strings.ReplaceAllë¡œ 19ì¢… íŠ¹ìˆ˜ë¬¸ì ì´ìŠ¤ì¼€ì´í”„
```

**MarkdownV2 ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬:**

Telegram MarkdownV2ëŠ” 19ê°œ íŠ¹ìˆ˜ë¬¸ìë¥¼ `\`ë¡œ ì´ìŠ¤ì¼€ì´í”„í•´ì•¼ í•©ë‹ˆë‹¤.
ì½”ë“œ ë¸”ë¡(``` ``` ```) ë‚´ë¶€ëŠ” `\`ì™€ `` ` ``ë§Œ ì´ìŠ¤ì¼€ì´í”„í•˜ë©´ ë©ë‹ˆë‹¤.

```
  ì¼ë°˜ í…ìŠ¤íŠ¸ ì´ìŠ¤ì¼€ì´í”„ (escape í•¨ìˆ˜):
    ì…ë ¥: "âœ… Terraform plan ì„±ê³µ"
    ì¶œë ¥: "âœ… Terraform plan ì„±ê³µ"  (ë³€í™˜ ì—†ìŒ - íŠ¹ìˆ˜ë¬¸ì ë¯¸í¬í•¨)

    ì…ë ¥: "ğŸ“ ë””ë ‰í† ë¦¬: crm_dev"
    ì¶œë ¥: "ğŸ“ ë””ë ‰í† ë¦¬: crm\_dev"  (_ ì´ìŠ¤ì¼€ì´í”„)

    ì…ë ¥: "â± ì†Œìš”ì‹œê°„: 12.3s"
    ì¶œë ¥: "â± ì†Œìš”ì‹œê°„: 12\.3s"    (. ì´ìŠ¤ì¼€ì´í”„)

  ì½”ë“œ ë¸”ë¡ ì´ìŠ¤ì¼€ì´í”„ (escapeCodeBlock í•¨ìˆ˜):
    \ â†’ \\
    ` â†’ \`
    ë‚˜ë¨¸ì§€ëŠ” ê·¸ëŒ€ë¡œ (ì½”ë“œ ë¸”ë¡ ì•ˆì—ì„œëŠ” ì´ìŠ¤ì¼€ì´í”„ ë¶ˆí•„ìš”)
```

**ì—ëŸ¬ ìš”ì•½ ì¶”ì¶œ:**

ì‹¤íŒ¨ ì‹œ stderr ë²„í¼ì—ì„œ ë§ˆì§€ë§‰ 10ì¤„ë§Œ ì¶”ì¶œí•˜ì—¬ ì•Œë¦¼ì— í¬í•¨í•©ë‹ˆë‹¤.

```
  terraform stderr (ìˆ˜ì‹­~ìˆ˜ë°± ì¤„)
       â”‚
       â–¼
  lastNLines(stderr, 10)
       â”‚
       â–¼
  ë§ˆì§€ë§‰ 10ì¤„ë§Œ ì½”ë“œ ë¸”ë¡ìœ¼ë¡œ ì „ì†¡
  â†’ Telegram ë©”ì‹œì§€ í¬ê¸° ì œí•œ(4096ì) ë‚´ì—ì„œ í•µì‹¬ ì—ëŸ¬ë§Œ ì „ë‹¬
```

### Config Loading Priority

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 1. Environment Variables (ìµœìš°ì„ )    â”‚
  â”‚    TELEGRAM_BOT_TOKEN               â”‚
  â”‚    TELEGRAM_CHAT_ID                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ missing?
                 â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 2. ~/.tfn.env (tfn ì „ìš© ì„¤ì • íŒŒì¼)   â”‚
  â”‚    Format: KEY=VALUE (per line)     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ missing?
                 â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 3. No config â†’ skip notification    â”‚
  â”‚    terraform runs normally          â”‚
  â”‚    (graceful degradation)           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Telegram Message Format

### Success

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ âœ… Terraform plan ì„±ê³µ              â”‚
  â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”               â”‚
  â”‚ ğŸ“ ë””ë ‰í† ë¦¬: crm_dev               â”‚
  â”‚ â± ì†Œìš”ì‹œê°„: 12.3s                  â”‚
  â”‚ ğŸ’» ëª…ë ¹ì–´: terraform plan -chdir=.. â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Failure

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ âŒ Terraform validate ì‹¤íŒ¨          â”‚
  â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”               â”‚
  â”‚ ğŸ“ ë””ë ‰í† ë¦¬: crm_dev               â”‚
  â”‚ â± ì†Œìš”ì‹œê°„: 0.8s                   â”‚
  â”‚ ğŸ’» ëª…ë ¹ì–´: terraform validate       â”‚
  â”‚                                    â”‚
  â”‚ ğŸ“‹ ì—ëŸ¬ ìš”ì•½:                       â”‚
  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚ â”‚ Error: Missing required arg..  â”‚ â”‚
  â”‚ â”‚ (stderr last 10 lines)         â”‚ â”‚
  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Installation

### Build

```bash
cd ~/khko_tools/tfn
go build -o tfn .
```

### Install (symlink)

```bash
sudo ln -sf ~/khko_tools/tfn/tfn /usr/local/bin/tfn
```

### Configure

**Option A: Config File (`~/.tfn.env`) â€” ê¶Œì¥**

```env
# tfn - Terraform Notify configuration
TELEGRAM_BOT_TOKEN=123456:ABC-DEF...
TELEGRAM_CHAT_ID=-100123456789
```

```bash
# Claude Code hook ì„¤ì •ì´ ì´ë¯¸ ìˆë‹¤ë©´, í•´ë‹¹ ê°’ì„ ë³µì‚¬í•˜ì—¬ ìƒì„±:
grep TELEGRAM ~/.claude/.env > ~/.tfn.env
```

**Option B: Environment Variables**

```bash
export TELEGRAM_BOT_TOKEN="123456:ABC-DEF..."
export TELEGRAM_CHAT_ID="-100123456789"
```

---

## Usage

```bash
# ì•Œë¦¼ ëŒ€ìƒ ëª…ë ¹ì–´ (plan, apply, init, validate)
tfn plan -chdir=terraform/environments/crm_dev
tfn apply -chdir=terraform/environments/crm_prd
tfn init -upgrade
tfn validate

# ì•Œë¦¼ ì—†ì´ íŒ¨ìŠ¤ìŠ¤ë£¨ (fmt, state, output, etc.)
tfn fmt
tfn state list
tfn output
tfn version

# exit codeëŠ” terraformê³¼ ë™ì¼í•˜ê²Œ ë³´ì¡´
tfn plan; echo $?   # terraformì˜ exit code ê·¸ëŒ€ë¡œ
```

---

## Command Classification

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Notify (ì•Œë¦¼)  â”‚   Passthrough Only (íŒ¨ìŠ¤ìŠ¤ë£¨)        â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚   plan           â”‚   fmt                               â”‚
  â”‚   apply          â”‚   state (list, show, mv, rm, ...)   â”‚
  â”‚   init           â”‚   output                            â”‚
  â”‚   validate       â”‚   version                           â”‚
  â”‚                  â”‚   import                             â”‚
  â”‚                  â”‚   console                            â”‚
  â”‚                  â”‚   providers                          â”‚
  â”‚                  â”‚   workspace                          â”‚
  â”‚                  â”‚   ... (ê·¸ ì™¸ ëª¨ë“  ì„œë¸Œì»¤ë§¨ë“œ)         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Verification

```bash
# 1. íŒ¨ìŠ¤ìŠ¤ë£¨ ë™ì‘ í™•ì¸
tfn version
# â†’ terraform version ì¶œë ¥

# 2. exit code ë³´ì¡´ í™•ì¸
tfn plan -chdir=nonexistent; echo $?
# â†’ exit code 1

# 3. ì•Œë¦¼ ìˆ˜ì‹  í™•ì¸ (config ì„¤ì • í›„)
tfn plan -chdir=terraform/environments/crm_dev
# â†’ í„°ë¯¸ë„ ì¶œë ¥ + Telegram ì•Œë¦¼

# 4. ì„¤ì • ì—†ì´ graceful degradation
unset TELEGRAM_BOT_TOKEN TELEGRAM_CHAT_ID
tfn validate
# â†’ terraformë§Œ ì‹¤í–‰, ì•Œë¦¼ ì—†ìŒ, ì—ëŸ¬ ì—†ìŒ
```

---

## Technical Decisions

| Decision | Choice | Reason |
|----------|--------|--------|
| Language | Go | Single binary, no runtime deps, cross-compile |
| Dependencies | stdlib only | Minimize build complexity, no supply chain risk |
| Config format | `.env` (KEY=VALUE) | Simple parsing without YAML library |
| Notification | Telegram Bot API | Simple HTTP POST, no SDK needed |
| stderr capture | Last 10 lines | Enough context without message size issues |
| MarkdownV2 | Manual escape | Telegram's escape rules are simple, no lib needed |
